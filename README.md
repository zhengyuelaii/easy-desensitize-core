# Easy Desensitize Core

> ğŸš€ **è½»é‡çº§ã€é«˜æ€§èƒ½ã€é«˜æ‰©å±•æ€§çš„ Java æ•°æ®è„±æ•å¼•æ“æ ¸å¿ƒåº“**

`easy-desensitize-core` æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ•°æ®è„±æ•æ ¸å¿ƒé€»è¾‘çš„å·¥å…·åº“ã€‚å®ƒä¸ä»…æ”¯æŒåŸºäºæ³¨è§£çš„å£°æ˜å¼è„±æ•ï¼Œè¿˜æä¾›äº†å¼ºå¤§çš„ç¼–ç¨‹å¼ APIï¼Œèƒ½å¤Ÿå®Œç¾å¤„ç†**å¤æ‚åµŒå¥—å¯¹è±¡**ã€**æ³›å‹å®¹å™¨**ï¼ˆå¦‚ `List<T>`, `Map<K,V>`ï¼‰ä»¥åŠ**åŠ¨æ€ç»“æ„**çš„æ•°æ®è„±æ•ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **âš¡ æè‡´æ€§èƒ½**ï¼šé‡‡ç”¨ **"å±€éƒ¨å¼ºå¼•ç”¨ + å…¨å±€è½¯å¼•ç”¨"** çš„äºŒçº§ç¼“å­˜æ¶æ„ï¼Œåå°„å…ƒæ•°æ®è§£ææŸè€—é™ä½ 90% ä»¥ä¸Šã€‚
- **ğŸ” æ·±åº¦é€’å½’**ï¼šå®Œç¾æ”¯æŒ `List`ã€`Set`ã€`Map` åŠå¤šå±‚åµŒå¥— Bean çš„é€’å½’è„±æ•ï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶å¤„ç†å¤æ‚å¯¹è±¡å›¾ã€‚
- **ğŸ›¡ï¸ æ³›å‹å‹å¥½**ï¼šè§£å†³äº† Java **æ³›å‹æ“¦é™¤**éš¾é¢˜ï¼Œé€šè¿‡è¿è¡Œæ—¶åŠ¨æ€æ¢æµ‹ï¼Œç²¾å‡†å¤„ç† `Result<T>`ã€`Page<T>` ç­‰æ³›å‹åŒ…è£…ç±»ã€‚
- **ğŸ§© é«˜åº¦æ‰©å±•**ï¼šæä¾› `MaskingDataResolver` æ¥å£ï¼Œæ”¯æŒ Lambda è¡¨è¾¾å¼å¿«é€Ÿæå–å¤æ‚å¯¹è±¡ï¼ˆå¦‚åˆ†é¡µå™¨ï¼‰ä¸­çš„å¾…è„±æ•æ•°æ®ã€‚
- **ğŸ› ï¸ ä¸°å¯Œå·¥å…·**ï¼šå†…ç½® `Masker` å·¥å…·ç±»ï¼Œæä¾›å¸¸ç”¨è„±æ•æ–¹æ³•çš„æç®€è°ƒç”¨ã€‚

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å¼•å…¥ä¾èµ–

```XML
<dependency>
    <groupId>com.github.zhengyuelaii</groupId>
    <artifactId>easy-desensitize-core</artifactId>
    <version>1.0.0</version>
</dependency>
```

### 2. åŸºç¡€ç”¨æ³•

åœ¨å®ä½“ç±»çš„å­—æ®µä¸Šæ·»åŠ  `@MaskingField` æ³¨è§£ï¼Œå¹¶æŒ‡å®šè„±æ•å¤„ç†å™¨ã€‚

```Java
public class User {

	@MaskingField(typeHandler = KeepFirstAndLastHandler.class)
	private String name;

	@MaskingField(typeHandler = FixedMaskHandler.class)
	private String password;

	// Getter And Setter ç•¥

}
```
æ‰§è¡Œè„±æ•
```java
public class QuickStart {
	
	public static void main(String[] args) {
		User user = new User();
		user.setName("å¼ å°å‡¡");
		user.setPassword("123456");
		
		EasyDesensitize.mask(user);
		System.out.println(user);
	}

}
```
è¾“å‡º
```
User [name=å¼ *å‡¡, password=******]
```

------

## ğŸ”§ è¿›é˜¶ç”¨æ³•

### 1. ç¼–ç¨‹å¼è„±æ•ï¼ˆæ— ä¾µå…¥ï¼‰

é€‚ç”¨äºæ— æ³•ä¿®æ”¹æºç æˆ–éœ€è¦åŠ¨æ€æŒ‡å®šè„±æ•è§„åˆ™çš„åœºæ™¯ã€‚

```Java
Map<String, MaskingHandler> handlerMap = new HashMap<>();
// ä¸º "idCard" å­—æ®µåŠ¨æ€æŒ‡å®šè„±æ•ç­–ç•¥
handlerMap.put("idCard", new KeepFirstAndLastHandler());
// ä¸º "phone" å­—æ®µæŒ‡å®šæ‰‹æœºå·è„±æ•ç­–ç•¥
handlerMap.put("phone", str -> Masker.mobile(str));

// æ‰§è¡Œè„±æ•
EasyDesensitize.mask(data, handlerMap);
```

### 2. å¤„ç†å¤æ‚å¯¹è±¡ï¼ˆResolverï¼‰

å¯¹äº `Page<T>`ã€`ResultWrapper<T>` ç­‰å¤æ‚åŒ…è£…å¯¹è±¡ï¼Œæ— éœ€ç¼–å†™å¤æ‚çš„åå°„é€»è¾‘ï¼Œä½¿ç”¨ `MaskingDataResolver` æ¥å£å³å¯ä¸€é”®æå–ã€‚

```Java
PageResult<UserVO> page = userService.queryPage();

// ä½¿ç”¨ Lambda è¡¨è¾¾å¼å‘Šè¯‰å¼•æ“ï¼šæˆ‘è¦è„±æ•çš„æ˜¯ getItems() è¿”å›çš„ List
EasyDesensitize.mask(page, p -> p.getItems().iterator());
```

### 3. å…¨å±€ç¼“å­˜æ§åˆ¶

æ¡†æ¶é»˜è®¤å¼€å¯åŸºäº `SoftReference` çš„å…¨å±€ç¼“å­˜ä»¥æå‡æ€§èƒ½ã€‚åœ¨å†…å­˜æå…¶æ•æ„Ÿæˆ–åŠ¨æ€ç±»åŠ è½½åœºæ™¯ä¸‹ï¼Œå¯æ‰‹åŠ¨å…³é—­ï¼š

```Java
// ç¬¬ä¸‰ä¸ªå‚æ•° false è¡¨ç¤ºå…³é—­å…¨å±€ç¼“å­˜ï¼Œä»…ä½¿ç”¨å•æ¬¡ä»»åŠ¡çº§ç¼“å­˜
EasyDesensitize.mask(data, handlerMap, false);

// æ‰‹åŠ¨æ¸…ç†å…¨å±€ç¼“å­˜ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
EasyDesensitize.clearCache();
```

------

## ğŸ› ï¸ å·¥å…·ç±» Masker

`Masker` æä¾›äº†è¯­ä¹‰åŒ–çš„é™æ€æ–¹æ³•ï¼Œæ— éœ€è®°å¿†å¤æ‚çš„ç´¢å¼•è®¡ç®—ã€‚

```Java
// TODO
```

------

## ğŸš€ æ€§èƒ½ä¸æ¶æ„è®¾è®¡

### äºŒçº§ç¼“å­˜æœºåˆ¶

ä¸ºäº†è§£å†³åå°„å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼Œæœ¬æ¡†æ¶è®¾è®¡äº†ç‹¬ç‰¹çš„äºŒçº§ç¼“å­˜ï¼š

1. **L1 å±€éƒ¨ç¼“å­˜ (Local Cache)**ï¼š
   - **ç”Ÿå‘½å‘¨æœŸ**ï¼šä»…åœ¨å•æ¬¡ `mask()` è°ƒç”¨é“¾ä¸­æœ‰æ•ˆã€‚
   - **ä½œç”¨**ï¼šä¿è¯åœ¨å¤„ç†å¤§å‹åˆ—è¡¨ï¼ˆå¦‚ `List<User>` 1000æ¡ï¼‰æ—¶ï¼Œå…ƒæ•°æ®åªè§£æä¸€æ¬¡ï¼Œä¸”ç»å¯¹çº¿ç¨‹å®‰å…¨ã€‚
2. **L2 å…¨å±€ç¼“å­˜ (Global Cache)**ï¼š
   - **å®ç°**ï¼š`ConcurrentHashMap<Class, SoftReference<List<FieldMeta>>>`
   - **ä½œç”¨**ï¼šè·¨è¯·æ±‚å¤ç”¨è§£æç»“æœã€‚ä½¿ç”¨ **è½¯å¼•ç”¨ (SoftReference)** åŒ…è£…ï¼Œå½“ JVM å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨å›æ”¶ï¼Œæœç» OOM é£é™©ã€‚

### æ³›å‹å®‰å…¨

åœ¨å¤„ç† `Map` å’Œ `Bean` å±æ€§èµ‹å€¼æ—¶ï¼Œæ¡†æ¶å†…ç½®äº†ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼š

- **è¿è¡Œæ—¶æ¢æµ‹**ï¼šé€’å½’å‰è‡ªåŠ¨åˆ¤æ–­å­—æ®µç±»å‹ï¼Œé˜²æ­¢æ³›å‹æ“¦é™¤å¯¼è‡´çš„ `ClassCastException`ã€‚
- **å®‰å…¨èµ‹å€¼**ï¼šä»…å½“å­—æ®µå®é™…å€¼ä¸º `String` æ—¶æ‰æ‰§è¡Œè„±æ•ï¼Œé¿å…è¯¯ä¼¤ `Integer/Long` ç­‰åŒåå­—æ®µã€‚

------

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue æˆ– Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. æ–°å»º Feat_xxx åˆ†æ”¯
3. æäº¤ä»£ç 
4. æ–°å»º Pull Request

------

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®åŸºäº [Apache License 2.0](https://www.google.com/search?q=LICENSE) åè®®å¼€æºã€‚